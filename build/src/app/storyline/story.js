(function(){var e,t,o,r,n;o=["ui.router","common.directives","common.tags","common.user_storage","rounds.services","cfp.hotkeys","cfp.hotkeys","rounds.services"],r=angular.module("tumblrGame.storyline",o),n=function(e){return e.state("story",{params:["type","category"],views:{header:{controller:"HeaderCtrl",templateUrl:"rounds/views/header.tpl.html"},main:{controller:"StoryCtrl",templateUrl:"storyline/story.tpl.html"}},data:{pageTitle:"Round Start"}})},n.$inject=["$stateProvider"],r.config(n),t=function(){function e(e,t,o,r,n,s,a,i,u,c){var l,m,d;e.round=n.get("current_round"),e.storyline=r.get_story(e.round,i.type),e.category=i.category||"tv series",d=t.random_tag_index(e.category),m=t.tag(e.category,d),l=o.fromPastMonths(12),e.posts=[],s.jsonp_query({tag:m.name,before:l},function(t){var o,r,n,s,a;for(e.message=t.meta,a=t.response,n=0,s=a.length;s>n&&(r=a[n],!("photo"===r.type&&(e.posts.push(r),e.posts.length>=6)));n++);return o=e.posts.map(function(e){return e.photos[0].alt_sizes[1].url}),c.preloadImages(o).then(function(){return e.isLoading=!1,e.isSuccessful=!0,console.info("Preload Successful")},function(t){return e.isLoading=!1,e.isSuccessful=!1,console.error("Image Failed",t),console.info("Preload Failure")},function(t){return e.percentLoaded=t.percent,console.info("Percent loaded:",t.percent)})}),e.dialogID=0,e.next=function(){return e.dialogID<e.storyline.length-1?e.dialogID=e.dialogID+1:a.transitionTo("round",{category:i.category,index:d,before:l})},u.bindTo(e).add({combo:"enter",description:"Next",callback:e.next})}return e.$inject=["$scope","TagsService","RandomDateService","StoryService","gameStorage","RoundsRes","$state","$stateParams","hotkeys","imagePreloader"],e}(),r.controller("StoryCtrl",t),e=function(){function e(e,t,o,r){this.content=e,this.type=null!=t?t:"modal",this.speaker=o,this.button=r}return e}(),r.service("StoryService",function(){var t,o,r;return t={"1_start":[new e("You're a bit confused by the premise of this test, so you message your mentor."),new e("Kcklqkla, if this test is pulling the latest posts from Tumblr, what guarantee is there that the posts would make sense in the context of the test? Humans sometimes tag things incorrectly.","message U","you"),new e("Oh, there's no guarantee. Sometimes it's gibberish. Sometimes it's human pornography. Have fun.","message K","kcklqkla"),new e("That was discouraging. The High Council is a cruel organization.")]},o={start:[[new e('Your mentor offers you words of encouragement: "Even if you fail your studies, maybe you can still be part of the mission to join the earth. You can just be a very stupid human." You do not find this encouraging.')],[new e("You think your mentor, Kcklqkla, is acting especially awkward around you. You suspect that they have read your smutty fanfics.")],[new e("You feel extremely nervous about this test. What if you confuse Teen Wolf for Supernatural? You'd be mortified.")]]},r={get_story:function(e,r){var n,s;return""+e+"_"+r in t?s=t[""+e+"_"+r]:(n=o[r],s=n[Math.floor(Math.random()*n.length)]),s}}})}).call(this);