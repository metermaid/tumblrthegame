(function(){var t,e,r,o;e=["ui.router","common.directives","common.tags","common.user_storage","rounds.services","cfp.hotkeys","story.services"],r=angular.module("tumblrGame.storyline",e),o=function(t){return t.state("story",{params:["type","category"],views:{header:{controller:"HeaderCtrl",templateUrl:"rounds/views/header.tpl.html"},main:{controller:"StoryCtrl",templateUrl:"storyline/story.tpl.html"}},data:{pageTitle:"Round Start"}})},o.$inject=["$stateProvider"],r.config(o),t=function(){function t(t,e,r,o,a,n,s,i,c,l){var d,u,g;t.round=a.get("current_round"),t.storyline=o.get_story(t.round,i.type),t.category=i.category||"tv series",g=e.random_tag_index(t.category),u=e.tag(t.category,g),d=r.fromPastMonths(12),t.posts=[],n.jsonp_query({tag:u.name,before:d},function(e){var r,o,a,n,s;for(t.message=e.meta,s=e.response,a=0,n=s.length;n>a&&(o=s[a],!("photo"===o.type&&(t.posts.push(o),t.posts.length>=6)));a++);return r=t.posts.map(function(t){return t.photos[0].alt_sizes[1].url}),l.preloadImages(r)}),t.dialogID=0,t.next=function(){return t.dialogID<t.storyline.length-1?t.dialogID=t.dialogID+1:t.start()},t.start=function(){return s.transitionTo("round",{category:i.category,index:g,before:d})},c.bindTo(t).add({combo:"space",description:"Next",callback:t.next}),c.bindTo(t).add({combo:"enter",description:"Skip",callback:t.start})}return t.$inject=["$scope","TagsService","RandomDateService","StoryService","gameStorage","RoundsRes","$state","$stateParams","hotkeys","imagePreloader"],t}(),r.controller("StoryCtrl",t)}).call(this);