(function(){var t;t=angular.module("common.preloader",[]),t.factory("ImagePreloader",function(e,i){var s,r,o,n,a,h,u,d;return s=function(t){return this.imageLocations=t,this.imageCount=this.imageLocations.length,this.loadCount=0,this.errorCount=0,this.states={PENDING:1,LOADING:2,RESOLVED:3,REJECTED:4},this.state=this.states.PENDING,this.deferred=e.defer(),this.promise=this.deferred.promise},s.preloadImages=function(e){return t=new s(e),t.load()},s.prototype={constructor:s,isInitiated:n=function(){return this.state!==this.states.PENDING},isRejected:a=function(){return this.state===this.states.REJECTED},isResolved:h=function(){return this.state===this.states.RESOLVED},load:u=function(){var t;if(this.isInitiated())return this.promise;for(this.state=this.states.LOADING,t=0;t<this.imageCount;)this.loadImageLocation(this.imageLocations[t]),t++;return this.promise},handleImageError:r=function(t){return this.errorCount++,this.isRejected()?void 0:(this.state=this.states.REJECTED,this.deferred.reject(t))},handleImageLoad:o=function(t){return this.loadCount++,this.isRejected()?void 0:(this.deferred.notify({percent:Math.ceil(this.loadCount/this.imageCount*100),imageLocation:t}),this.loadCount===this.imageCount?(this.state=this.states.RESOLVED,this.deferred.resolve(this.imageLocations)):void 0)},loadImageLocation:d=function(e){var s;return t=this,s=$(new Image).load(function(e){return i.$apply(function(){return t.handleImageLoad(e.target.src),t=s=e=null}),i.$apply(function(){return t.handleImageError(e.target.src),t=s=e=null})}).prop("src",e)}},s})}).call(this);