(function(){var e,t;t=angular.module("tumblrGame.rounds"),e=function(){function e(e,t,n,r,o,s,u,a){var c,i,m,d;e.round=o.get("current_round"),e.type=u.type||"series",e.roundStartTime=Date.now(),e.secondsLeft=10,i=t.random_tag(e.type),e.correct=!1,e.guess="",m=new RegExp("^#?"+i.regex.source+"$","i"),c=n.fromPastMonths(12),r.jsonp_query({tag:i.name,before:c},function(t){return e.message=t.meta,e.posts=t.response}),e.$watch("guess",function(t){return t&&0!==t.length?(e.correct=-1!==t.search(m),e.correct):0}),e.$watch("correct",function(t){return t?(o.increment("current_round",1),e.stop(),s.transitionTo("end",{tag:i.name,before:c,win:!0})):void 0}),d=null,e.onTimeout=function(){return e.secondsLeft--,e.secondsLeft>=1?d=a(e.onTimeout,1e3):(e.stop(),s.transitionTo("end",{tag:i.name,before:c,win:!1}))},d=a(e.onTimeout,1e3),e.stop=function(){return a.cancel(d)}}return e.$inject=["$scope","TagsService","RandomDateService","RoundsRes","gameStorage","$state","$stateParams","$timeout"],e}(),t.controller("RoundCtrl",e)}).call(this);