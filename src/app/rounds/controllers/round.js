(function(){var e,t;t=angular.module("tumblrGame.rounds"),e=function(){function e(e,t,n,o,r,s,u,c){var a,i,m,d;e.round=r.get("current_round"),e.type=u.type||"series",e.roundStartTime=Date.now(),e.secondsLeft=10,i=t.random_tag(e.type),e.correct=!1,e.guess="",m=new RegExp("^#?"+i.regex.source+"$","i"),a=n.fromPastMonths(12),o.jsonp_query({tag:i.name,before:a},function(t){return e.message=t.meta,e.posts=t.response}),e.$watch("guess",function(t){return t&&0!==t.length?(e.correct=-1!==t.search(m),e.correct):0}),e.$watch("correct",function(e){return e?(r.increment("current_round",1),s.transitionTo("end",{tag:i.name,before:a})):void 0}),d=null,e.onTimeout=function(){return e.secondsLeft--,e.secondsLeft>=1?d=c(e.onTimeout,1e3):(console.log("time out"),s.transitionTo("end",{tag:i.name,before:a}))},d=c(e.onTimeout,1e3),e.stop=function(){return c.cancel(d)}}return e.$inject=["$scope","TagsService","RandomDateService","RoundsRes","gameStorage","$state","$stateParams","$timeout"],e}(),t.controller("RoundCtrl",e)}).call(this);